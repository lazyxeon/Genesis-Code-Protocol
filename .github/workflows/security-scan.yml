name: Security Scan (Bandit & Safety)

on:
  push:
    branches: ["main"]
    paths:
      - '**/*.py'
      - '.github/workflows/security-scan.yml'
  pull_request:
    paths:
      - '**/*.py'
      - '.github/workflows/security-scan.yml'
  schedule:
    - cron: "30 1 * * *"  # daily at 01:30 UTC
  workflow_dispatch:

# Restrict default token permissions.
permissions:
  contents: read

jobs:
  scan:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8
      - name: Set up Python
        uses: actions/setup-python@a26af69be951a213d495a4c3e4e4022e16d87065
        with:
          python-version: '3.11'
      - name: Install security tools
        run: |
          python -m pip install --upgrade pip
          pip install bandit safety
      - name: Run Bandit (static analysis)
        run: |
          bandit -r . -x "node_modules,venv,.venv,dist,build" -f txt || true
      - name: Run Safety (vulnerability check)
        run: |
          safety check --full-report || true
