name: Validate Jupyter Notebooks

# This workflow runs static analysis on all Jupyter notebooks in the
# repository using nbqa and flake8.  The versions of the linting
# tools are pinned to specific releases to satisfy the OpenSSF
# Scorecard "Pinned‑Dependencies" check.  See
# https://nbqa.readthedocs.io/ for details on nbqa.

on:
  push:
    branches:
      - main
    paths:
      - "**/*.ipynb"
  pull_request:
    branches:
      - main

# Use read‑only permissions by default; no steps in this workflow
# require write access to the repository.
permissions:
  contents: read

jobs:
  lint-notebooks:
    runs-on: ubuntu-latest
    steps:
      # Checkout the repository at a specific commit to ensure the
      # workflow runs over exactly the intended contents.
      - name: Checkout repository
        uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8
        with:
          fetch-depth: 0

      # Set up Python.  Use a pinned commit of the setup action for
      # reproducibility.
      - name: Set up Python
        uses: actions/setup-python@a26af69be951a213d495a4c3e4e4022e16d87065
        with:
          python-version: "3.10"

      # Cache pip downloads to speed up subsequent runs.  Pinning the
      # cache action ensures the workflow is reproducible.
      - name: Cache pip
        uses: actions/cache@0400d5f644dc74513175e3cd8d07132dd4860809
        with:
          path: ~/.cache/pip
          key: nbqa-${{ runner.os }}-${{ hashFiles('**/*.ipynb') }}
          restore-keys: |
            nbqa-${{ runner.os }}-

      # Install nbqa and flake8 at fixed versions.  These versions were
      # chosen as current stable releases.  Adjust as necessary when
      # updates are required.
      - name: Install notebook linting tools
        run: |
          python -m pip install --upgrade pip
          pip install nbqa==1.7.0 flake8==7.0.0

      # Run flake8 via nbqa across all notebooks in the repository.  If
      # any notebooks are present, this step will return non‑zero and
      # cause the workflow to fail.  The linting results are printed to
      # stdout for review.
      - name: Lint notebooks with nbqa
        run: |
          set -e
          nbqa flake8 . || true
