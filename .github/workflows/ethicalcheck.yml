# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

# EthicalCheck addresses the critical need to continuously security test APIs in development and in production.

# EthicalCheck provides the industry’s only free & automated API security testing service that uncovers security vulnerabilities using OWASP API list.
# Developers relies on EthicalCheck to evaluate every update and release, ensuring that no APIs go to production with exploitable vulnerabilities.

# You develop the application and API, we bring complete and continuous security testing to you, accelerating development.

# Know your API and Applications are secure with EthicalCheck – our free & automated API security testing service.

# How EthicalCheck works?
# EthicalCheck functions in the following simple steps.
# 1. Security Testing.
# Provide your OpenAPI specification or start with a public Postman collection URL.
# EthicalCheck instantly instrospects your API and creates a map of API endpoints for security testing.
# It then automatically creates hundreds of security tests that are non-intrusive to comprehensively and completely test for authentication, authorizations, and OWASP bugs your API. The tests addresses the OWASP API Security categories including OAuth 2.0, JWT, Rate Limit etc.

# 2. Reporting.
# EthicalCheck generates security test report that includes all the tested endpoints, coverage graph, exceptions, and vulnerabilities.
# Vulnerabilities are fully triaged, it contains CVSS score, severity, endpoint information, and OWASP tagging.


# This is a starter workflow to help you get started with EthicalCheck Actions

name: EthicalCheck-Workflow

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "main" branch
  # Customize trigger events based on your DevSecOps processes.
  push:
  pull_request:
  schedule:
    - cron: '33 16 * * 5'

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

permissions:
  contents: read
  security-events: write

env:
  ETHICALCHECK_OAS_URL: ${{ vars.ETHICALCHECK_OAS_URL || '' }}
  ETHICALCHECK_EMAIL: ${{ vars.ETHICALCHECK_EMAIL || '' }}

jobs:
  Trigger_EthicalCheck:
    if: ${{ env.ETHICALCHECK_OAS_URL != '' && env.ETHICALCHECK_EMAIL != '' }}
    continue-on-error: true
    permissions:
      contents: read
      security-events: write
      actions: read # required for a private repository by github/codeql-action/upload-sarif to get the Action run status
    runs-on: ubuntu-latest

    steps:
       - uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8
       - name: EthicalCheck Free & Automated API Security Testing Service
         uses: Octota-GitHub/ethicalcheck-action@3ec5e93b42e591349e46635da9f909bac66c23a9
         continue-on-error: true
         with:
          # The OpenAPI Specification URL or Swagger Path or Public Postman collection URL.
          oas-url: ${{ env.ETHICALCHECK_OAS_URL }}
          # The email address to which the penetration test report will be sent.
          email: ${{ env.ETHICALCHECK_EMAIL }}
          sarif-result-file: ethicalcheck-results.sarif

       - name: Upload sarif file to repository
         if: ${{ hashFiles('ethicalcheck-results.sarif') != '' }}
         uses: github/codeql-action/upload-sarif@3c3833e0f8c1c83d449a7478aa59c036a9165498
         with:
          sarif_file: ./ethicalcheck-results.sarif
